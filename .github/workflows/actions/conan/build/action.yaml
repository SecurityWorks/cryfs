name: 'Build'
description: 'Compile CryFS'
inputs:
  extra_conan_flags:
    description: "Extra flags to add to the cmake command"
    required: true
runs:
  using: "composite"
  steps:
    - name: Run build
      shell: bash
      run: |
        set -v
        set -e
        conan profile show

        # TODO Add ccache
        # cmake .. -GNinja -DCMAKE_CXX_COMPILER=${{inputs.cxx}} -DCMAKE_C_COMPILER=${{inputs.cc}} -DBUILD_TESTING=on -DCMAKE_BUILD_TYPE=${{inputs.build_type}} -DCMAKE_CXX_COMPILER_LAUNCHER=ccache -DCMAKE_C_COMPILER_LAUNCHER=ccache ${{inputs.extra_cmake_flags}}

        conan build . --build=missing -o "&:build_tests=True" ${{ inputs.extra_conan_flags }}
